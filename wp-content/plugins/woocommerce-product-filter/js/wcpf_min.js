/**
 * CodeNegar WooCommerce AJAX Product Filter 
 * WCPF: WooCommerce Product Filter
 *
 * Frontend Script File
 *
 * @package	WooCommerce AJAX Product Filter
 * @author	Farhad Ahmadi
 * @link	http://codenegar.com/woocommerce-ajax-product-filter/
 * version	2.3
 */
var codenegar_page_title="";function codenegar_addParameter(url,parameterName,parameterValue,atStart){replaceDuplicates=true;if(url.indexOf("#")>0){var cl=url.indexOf("#");urlhash=url.substring(url.indexOf("#"),url.length)}else{urlhash="";cl=url.length}sourceUrl=url.substring(0,cl);var urlParts=sourceUrl.split("?");var newQueryString="";if(urlParts.length>1){var parameters=urlParts[1].split("&");for(var i=0;(i<parameters.length);i++){var parameterParts=parameters[i].split("=");if(!(replaceDuplicates&&parameterParts[0]==parameterName)){if(newQueryString==""){newQueryString="?"}else{newQueryString+="&"}newQueryString+=parameterParts[0]+"="+(parameterParts[1]?parameterParts[1]:"")}}}if(newQueryString==""){newQueryString="?"}if(atStart){newQueryString="?"+parameterName+"="+parameterValue+(newQueryString.length>1?"&"+newQueryString.substring(1):"")}else{if(newQueryString!==""&&newQueryString!="?"){newQueryString+="&"}newQueryString+=parameterName+"="+(parameterValue?parameterValue:"")}return urlParts[0]+newQueryString+urlhash}function codenegar_correct_cnep($pagination){$pagination.find("a[href]").each(function(){var new_href=jQuery(this).attr("href").replace("cnep=0","cnep=1");jQuery(this).attr("href",new_href)});return $pagination}function codenegar_update_pagination(){var current_theme=codenegar_wcpf_config.current_theme;if(current_theme.indexOf("stylemag")>-1){return true}return false}function codenegar_add_overlay($wrap,options){var defaults={bgColor:"#fff",opacity:codenegar_wcpf_config.ajax_overlay_opacity,duration:600,spinner:codenegar_wcpf_config.loader_img,wrap_id:"codenegar_ajax_loader",wrap_class:"codenegar-ajax-loader blockUI blockOverlay"};options=jQuery.extend(defaults,options);if(codenegar_wcpf_config.ajax_overlay_color=="transparent"){options.bgColor="transparent"}var overlay=jQuery("<div></div>").css({"background-color":options.bgColor,opacity:options.opacity,width:"100%",height:"100%",top:"0px",left:"0px",cursor:"default","text-align":"center","z-index":99900,border:"none",margin:"0px",padding:"0px",border:"none","background-image":'url("'+options.spinner+'")',"background-position":"50% 50%","background-repeat":"no-repeat"}).attr("class",options.wrap_class).attr("id",options.wrap_id);if(codenegar_wcpf_config.absolute_positioned_container=="yes"){overlay.css("position","absolute");$wrap.css("position","relative")}if(codenegar_wcpf_config.ajax_overlay_style=="append"){$wrap.append(overlay).fadeIn(options.duration)}else{if(codenegar_wcpf_config.ajax_overlay_style=="prepend"){$wrap.prepend(overlay).fadeIn(options.duration)}else{if(codenegar_wcpf_config.ajax_overlay_style=="replace"){$wrap.html(overlay).fadeIn(options.duration)}}}}function codenegar_remove_overlay($wrap){$wrap.children("#codenegar_ajax_loader").fadeOut("500",function(){jQuery(this).remove()})}function codenegar_format_range(template,min,max){var ret=template;ret=ret.replace("%s",min);ret=ret.replace("%e",max);return ret}function codenegar_get_parameter(name){name=name.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var regexS="[\\?&]"+name+"=([^&#]*)";var regex=new RegExp(regexS);var state=History.getState();var current_url=state.cleanUrl;var results=regex.exec(current_url);if(results==null){return""}else{return results[1]}}function wcpf_is_cat_cat_clicked(){var State=History.getState();var selected_cat="not";var url=State.cleanUrl;var last_parameter=url.substring(url.lastIndexOf("&")+1);if(last_parameter.length>0&&last_parameter.indexOf("=")>-1){last_parameter=last_parameter.split("=");if(last_parameter.length==2&&last_parameter[0]=="cat_cat"){selected_cat=last_parameter[1]}}if(parseInt(selected_cat)>0||selected_cat=="0"){return true}return false}function codenegar_wcpf_add_parameter(widget,type,key,value){var state=History.getState();var current_url=state.cleanUrl;var new_url="";var new_key=widget+"_"+key;if(new_key=="orderby_orderby"){new_key="orderby"}new_url=codenegar_addParameter(current_url,"cnpf","1",true);new_url=codenegar_addParameter(new_url,"cnep","0");new_url=codenegar_addParameter(new_url,new_key,value);if((document.URL==codenegar_wcpf_config.home_url)||(document.URL==codenegar_wcpf_config.home_url+"/")){new_url=codenegar_addParameter(new_url,"post_type","product")}if(codenegar_page_title.length==0){codenegar_page_title=jQuery("title").text()}History.pushState({state:1},codenegar_page_title,new_url)}function codenegar_make_slider($this){var min=parseInt($this.closest(".codenegar_slider_wrapper").next().attr("data-min"));var max=parseInt($this.closest(".codenegar_slider_wrapper").next().attr("data-max"));var template=$this.closest(".codenegar_slider_wrapper").next().attr("data-template");var widget=$this.closest(".codenegar_slider_wrapper").next().attr("data-widget");var type=$this.closest(".codenegar_slider_wrapper").next().attr("data-type");var key=$this.closest(".codenegar_slider_wrapper").next().attr("data-key");var step=parseInt($this.closest(".codenegar_slider_wrapper").next().attr("data-step"));current_values=codenegar_get_parameter(widget+"_"+key);var current_min=0;var current_max=0;if(parseInt(codenegar_get_parameter("cnpf"))==1&&current_values.length>0){current_values=current_values.split(",");if(current_values.length==2){current_min=parseInt(current_values[0]);current_max=parseInt(current_values[1])}}if(!((parseInt(current_min)>0))){current_min=min}if(!((parseInt(current_max)>0))){current_max=max}$this.slider({range:true,min:min,max:max,step:step,values:[current_min,current_max],create:function(event,ui){$this.closest(".codenegar_slider_wrapper").next().children(".min_value").val(current_min);$this.closest(".codenegar_slider_wrapper").next().children(".max_value").val(current_max)},slide:function(event,ui){$this.closest(".codenegar_slider_wrapper").next().children(".min_value").val(ui.values[0]);$this.closest(".codenegar_slider_wrapper").next().children(".max_value").val(ui.values[1]);$this.closest(".codenegar_slider_wrapper").next().children(".amount").html(codenegar_format_range(template,ui.values[0],ui.values[1]))},change:function(event,ui){if(event.originalEvent){var value=ui.values[0]+","+ui.values[1];codenegar_wcpf_add_parameter(widget,type,key,value)}}});$this.closest(".codenegar_slider_wrapper").next().children(".amount").html(codenegar_format_range(template,current_min,current_max))}function update_filters_count($data){if(codenegar_wcpf_config.count_filter_items!="yes"){return}var is_cat_cat_clicked=wcpf_is_cat_cat_clicked();$data.find(".wcpf_updating_widget").each(function(){var $this=jQuery(this);var id=$this.attr("id");if(is_cat_cat_clicked==true&&id=="wcpf_cat_cat_list"){return true}jQuery("#"+id).hide().html($this.html()).fadeIn()})}function codenegar_get_theme_selector(){var current_theme=codenegar_wcpf_config.current_theme;if(current_theme.indexOf("the retailer")>-1){if(jQuery(".listing_products").length>0){return".listing_products"}if(jQuery(".listing_products_no_sidebar").length>0){return".listing_products_no_sidebar"}}if(current_theme.indexOf("blanco")>-1){return"#default_products_page_container"}if(current_theme.indexOf("simplicity")>-1){return"#contentarea .grid_9"}if(current_theme.indexOf("flatsome")>-1){return"div.large-9"}if(current_theme.indexOf("foxy")>-1){return"div#et_results_settings"}return""}function wcpf_auto_override_selector(){var current_theme=codenegar_wcpf_config.current_theme;if(current_theme.indexOf("flatsome")>-1&&jQuery(".codenegar-shop-loop-wrapper ul").length==0){return true}return false}function hide_empty_widgets(){if(codenegar_wcpf_config.hide_empty_widgets!="yes"){return}jQuery(".wcpf_updating_widget ul").each(function(){var $this=jQuery(this);var size=parseInt($this.children("li").size());if(size==0){$this.parents(".wcpf_master_wrap").hide()}else{$this.parents(".wcpf_master_wrap").show()}});jQuery("..wcpf_updating_widget select").each(function(){var $this=jQuery(this);var size=parseInt($this.children("option").size());if(size==0){$this.parents(".wcpf_master_wrap").hide()}else{$this.parents(".wcpf_master_wrap").show()}})}function wcpf_get_main_ul(){if(jQuery("ul.products").length>0){return"ul.products"}if(jQuery("ul#products").length>0){return"ul#products"}var max=-1;var selector="";jQuery("ul").not(".ab-top-menu, .nav, .ab-submenu, #sidebar ul, .sidebar ul").not("nav ul").not("aside ul").not("ul[role='navigation']").not(".codenegar_product_filter_wrap  ul").each(function(){if(jQuery(this).width()>max){selector=this;max=jQuery(this).width()}});return selector}jQuery(function(){jQuery(".range_meta_slider").each(function(){codenegar_make_slider(jQuery(this))});codenegar_page_title=jQuery("title").text();jQuery("a.codenegar_product_filter_reset_button").live("click",function(e){e.preventDefault();$this=jQuery(this);var new_url=$this.attr("data-url");new_url=codenegar_addParameter(new_url,"cnpf","1");new_url=codenegar_addParameter(new_url,"cnep","0");if(codenegar_page_title.length==0){codenegar_page_title=jQuery("title").text()}if(parseInt(codenegar_get_parameter("cat_cat"))>0||parseInt(codenegar_get_parameter("cnpf"))=="0"){var applied_id=codenegar_get_parameter("cat_cat");var cat_parameter=jQuery('.codenegar_product_filter_wrap ul li.codenegar_applied_filter_cat a[data-old-value="'+applied_id+'"]').attr("data-value");new_url=codenegar_addParameter(new_url,"cat_cat",cat_parameter)}jQuery(".range_meta_slider").each(function(){$this=jQuery(this);var min=parseInt($this.closest(".codenegar_slider_wrapper").next().attr("data-min"));var max=parseInt($this.closest(".codenegar_slider_wrapper").next().attr("data-max"));var template=$this.closest(".codenegar_slider_wrapper").next().attr("data-template");$this.slider("values",[min,max]);$this.closest(".codenegar_slider_wrapper").next().children(".amount").html(codenegar_format_range(template,min,max))});jQuery(".codenegar_product_filter_wrap select option:first-child").each(function(){jQuery(this).attr("selected","selected")});History.pushState({state:1},codenegar_page_title,new_url);jQuery(".codenegar_product_filter_wrap ul li").removeClass("codenegar_applied_filter chosen")});jQuery(".codenegar_product_filter_wrap ul li a").live("click",function(e){e.preventDefault();var $this=jQuery(this);if($this.attr("data-key")=="cat"&&$this.attr("data-widget")=="cat"){$this.closest("li").siblings().removeClass("codenegar_applied_filter chosen")}$this.closest("li").toggleClass("codenegar_applied_filter chosen");var widget=$this.attr("data-widget");var type=$this.attr("data-type");var key=$this.attr("data-key");var value=$this.attr("data-value");var new_key=widget+"_"+key;var current_value=codenegar_get_parameter(new_key);if(current_value!=""&&new_key!="cat_cat"){current_value=current_value.split(",")}else{current_value=[]}var value_index=jQuery.inArray(value,current_value);if(value_index>-1){current_value.splice(value_index,1)}else{current_value.push(value)}new_value=current_value.join(",");if(new_key=="cat_cat"&&codenegar_get_parameter("cat_cat")==new_value){new_value=""}codenegar_wcpf_add_parameter(widget,type,key,new_value)});jQuery(".codenegar_product_filter_wrap select").live("change",function(){var $this=jQuery("option:selected",this);var widget=$this.attr("data-widget");var type=$this.attr("data-type");var key=$this.attr("data-key");var value=$this.val();codenegar_wcpf_add_parameter(widget,type,key,value)});var state=History.getState();var current_url=state.cleanUrl;var has_pushstate=!!(window.history&&history.pushState);var has_hash=!!(current_url.indexOf("#?")!=-1);var cnpf=!!(current_url.indexOf("cnpf")!=-1);if(!has_pushstate&&has_hash&&cnpf){current_url=current_url.replace("#?","?");if(codenegar_page_title.length==0){codenegar_page_title=jQuery("title").text()}History.pushState({state:1},codenegar_page_title,current_url)}});(function(window,undefined){var History=window.History;if(!History.enabled){return false}History.Adapter.bind(window,"statechange",function(){var State=History.getState();var selector=".codenegar-shop-loop-wrapper";var $wrap=jQuery(".codenegar-shop-loop-wrapper");if($wrap.length==0){selector=wcpf_get_main_ul();$wrap=jQuery(selector)}if(codenegar_get_theme_selector().length>0){$wrap=jQuery(codenegar_get_theme_selector());selector=codenegar_get_theme_selector()}if(wcpf_auto_override_selector()){$wrap=jQuery(codenegar_get_theme_selector());selector=codenegar_get_theme_selector()}if(codenegar_wcpf_config.wrapper_selector.length>0){$wrap=jQuery(codenegar_wcpf_config.wrapper_selector);selector=codenegar_wcpf_config.wrapper_selector}codenegar_add_overlay(jQuery(selector),{});if(typeof wcsl_before_ajax=="function"){wcsl_before_ajax()}if(typeof wcpf_before_ajax=="function"){wcpf_before_ajax()}jQuery.get(State.cleanUrl,function(data){var $data=jQuery(data);var shop_loop=$data.find(selector);if(shop_loop.length>0){$wrap.hide().html(shop_loop.html()).fadeIn()}else{if(codenegar_wcpf_config.display_no_products_message=="yes"){$wrap.hide().html(codenegar_wcpf_config.no_products_message).fadeIn()}}if($data.find(selector).children(".codenegar-shop-pagination-wrapper").length==0){jQuery(".codenegar-shop-pagination-wrapper").hide().html($data.find(".codenegar-shop-pagination-wrapper")).fadeIn()}if($data.find(selector).children(".woocommerce-result-count").length==0){jQuery(".woocommerce-result-count").hide().html($data.find(".woocommerce-result-count")).fadeIn()}var paging_selector=".pagination, .woo-pagination, .woocommerce-pagination, .emm-paginate, .wp-pagenavi, .pagination-wrapper";if($data.find(".codenegar-shop-loop-wrapper").children(paging_selector).length==0||codenegar_update_pagination()){var new_pagination=$data.find(paging_selector);new_pagination=codenegar_correct_cnep(new_pagination);jQuery(paging_selector).hide().html(new_pagination).fadeIn()}var selected_cat=0;var url=State.cleanUrl;var last_parameter=url.substring(url.lastIndexOf("&")+1);if(last_parameter.length>0&&last_parameter.indexOf("=")>-1){last_parameter=last_parameter.split("=");if(last_parameter.length==2&&last_parameter[0]=="cat_cat"){selected_cat=last_parameter[1]}}if(parseInt(selected_cat)>0||selected_cat=="0"){var clicked_widget=jQuery(".codenegar_product_filter_wrap ul li a[data-value="+selected_cat+"]").closest(".codenegar_product_filter_wrap");var updated_widget=$data.find(".codenegar_product_filter_wrap ul li a[data-old-value="+selected_cat+"]").closest(".codenegar_product_filter_wrap").children();if(updated_widget.length>0){clicked_widget.hide().html(updated_widget).fadeIn()}}update_filters_count($data);hide_empty_widgets();if(typeof wcsl_on_update=="function"||typeof wcpf_on_update=="function"){var areas=[];if(typeof wcpf_on_update=="function"){areas=wcpf_on_update()}else{areas=wcsl_on_update()}var areas=wcsl_on_update();var length=areas.length;for(var i=0;i<length;i++){var element=areas[i];var updated_area=$data.find(element).html();if(updated_area&&updated_area.length>0){jQuery(element).hide().html(updated_area).fadeIn()}else{jQuery(element).hide().html("")}}}if(codenegar_wcpf_config.custom_areas.length>0){var areas=codenegar_wcpf_config.custom_areas.split(",");var length=areas.length;for(var i=0;i<length;i++){var element=areas[i];var updated_area=$data.find(element).html();if(updated_area&&updated_area.length>0){jQuery(element).hide().html(updated_area).fadeIn()}else{jQuery(element).hide().html("")}}}}).done(function(){codenegar_remove_overlay(jQuery(selector));if(codenegar_wcpf_config.scroll_to_top=="yes"){jQuery(selector).ScrollTo()}if(typeof wcsl_ajax_done=="function"){wcsl_ajax_done()}if(typeof wcpf_ajax_done=="function"){wcpf_ajax_done()}}).fail(function(){if(typeof wcsl_ajax_fail=="function"){wcsl_ajax_fail()}if(typeof wcpf_ajax_fail=="function"){wcpf_ajax_fail()}$wrap.hide().html(codenegar_wcpf_config.no_products_message).fadeIn()}).always(function(){if(typeof wcsl_after_ajax=="function"){wcsl_after_ajax()}if(typeof wcpf_after_ajax=="function"){wcpf_after_ajax()}})})})(window);(function($){$(document).ready(function(){$(function(){jQuery("select.orderby").live("change",function(){if(jQuery(this).hasClass("codenegar_product_filter_orderby")){return}jQuery(this).closest("form").submit()})})})})(jQuery);